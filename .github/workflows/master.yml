name: Deploy

on:
  push:
    branches: [ master ]
    
jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    - name: Install Node
      uses: actions/setup-node@v1

    - name: Run Build
      run: npm run build
      
    - name: Deploy production
      uses: Pendect/action-rsyncer@v1.1.0
      env:
        DEPLOY_KEY: ${{secrets.DEPLOY_KEY}}
      with:
        flags: '-avzr --delete'
        options: '--exclude="node_modules" --exclude=".git" --exclude=".github" --exclude=".gitattributes" --exclude=".gitignore" --exclude=".stylelintrc"'
        src: './'
        dest: 'vadim@wp-server.ru:/var/www/lustshop/www/test'
